<div class="feature-card">
                        <h3>üîç Scan Comparison</h3>
                        <p>Upload two scan reports to see what's been fixed, what's new, and what still needs attention.</p>
                        
                        <form id="compareScanForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="oldScanFile" class="required">Previous Scan Report</label>
                                    <div class="upload-zone" onclick="document.getElementById('oldScanFile').click()">
                                        <div style="font-size: 2em; margin-bottom: 10px;">üìÑ</div>
                                        <p><strong>Upload Previous Scan</strong></p>
                                        <p class="help-text">Baseline scan for comparison</p>
                                    </div>
                                    <input type="file" id="oldScanFile" style="display: none;" 
                                           accept=".csv,.json,.xml,.html" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="newScanFile" class="required">Current Scan Report</label>
                                    <div class="upload-zone" onclick="document.getElementById('newScanFile').click()">
                                        <div style="font-size: 2em; margin-bottom: 10px;">üìÑ</div>
                                        <p><strong>Upload Current Scan</strong></p>
                                        <p class="help-text">Latest scan results</p>
                                    </div>
                                    <input type="file" id="newScanFile" style="display: none;" 
                                           accept=".csv,.json,.xml,.html" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="reportFormat">Output Format</label>
                                <select id="reportFormat">
                                    <option value="html">HTML Report (Recommended)</option>
                                    <option value="json">JSON Data</option>
                                </select>
                            </div>
                            
                            <div class="button-group">
                                <button type="submit" class="btn btn-primary">
                                    üìä Generate Comparison Report
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div id="compareResults" style="display: none;">
                        <div class="alert alert-success">
                            <h4>üìä Comparison Complete</h4>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" style="color: #48bb78;" id="fixedIssues">0</div>
                                <div class="stat-label">Fixed Issues</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" style="color: #e53e3e;" id="newIssues">0</div>
                                <div class="stat-label">New Issues</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" style="color: #dd6b20;" id="persistentIssues">0</div>
                                <div class="stat-label">Still Present</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" style="color: #3182ce;" id="needsAttention">0</div>
                                <div class="stat-label">Needs Attention</div>
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <button class="btn btn-primary" id="downloadComparisonBtn">
                                üì• Download Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEW FEATURE: Email Reports Tab -->
            <div class="tab-content" id="email-reports-tab">
                <div class="content">
                    <h2>üìß Email Report Configuration</h2>
                    <p style="margin-bottom: 30px;">Configure email notifications and reports for your organization.</p>
                    
                    <div class="email-config">
                        <h3>üè¢ VAA Company Email Settings</h3>
                        <p>All emails will be sent to addresses ending with @vaa.com</p>
                    </div>
                    
                    <div class="feature-card">
                        <h3>üì¨ Send Vulnerability Report</h3>
                        <p>Generate and email a comprehensive vulnerability report to your team.</p>
                        
                        <form id="emailReportForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="emailReportFile" class="required">Vulnerability Report</label>
                                    <input type="file" id="emailReportFile" required
                                           accept=".csv,.json,.xml,.html">
                                    <div class="help-text">Upload your vulnerability scan report</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="recipientUsername" class="required">Recipient Username</label>
                                    <input type="text" id="recipientUsername" required
                                           placeholder="john.doe">
                                    <div class="help-text">Will send to: username@vaa.com</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="reportType">Report Type</label>
                                    <select id="reportType">
                                        <option value="summary">Executive Summary</option>
                                        <option value="detailed">Detailed Technical Report</option>
                                        <option value="actionable">Actionable Items Only</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="emailSubject">Email Subject</label>
                                    <input type="text" id="emailSubject" 
                                           placeholder="Vulnerability Report - [Date]">
                                    <div class="help-text">Leave empty for auto-generated subject</div>
                                </div>
                            </div>
                            
                            <div class="button-group">
                                <button type="submit" class="btn btn-primary">
                                    üìß Generate & Send Report
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="feature-card">
                        <h3>üìä Send Comparison Report</h3>
                        <p>Email a before/after comparison of vulnerability scans.</p>
                        
                        <form id="emailComparisonForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="emailOldScan" class="required">Previous Scan</label>
                                    <input type="file" id="emailOldScan" required
                                           accept=".csv,.json,.xml,.html">
                                </div>
                                
                                <div class="form-group">
                                    <label for="emailNewScan" class="required">Current Scan</label>
                                    <input type="file" id="emailNewScan" required
                                           accept=".csv,.json,.xml,.html">
                                </div>
                                
                                <div class="form-group">
                                    <label for="comparisonRecipient" class="required">Recipient Username</label>
                                    <input type="text" id="comparisonRecipient" required
                                           placeholder="manager.name">
                                    <div class="help-text">Will send to: username@vaa.com</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="includeActionItems">
                                        <input type="checkbox" id="includeActionItems" checked>
                                        Include Action Items
                                    </label>
                                    <div class="help-text">Add prioritized to-do list to email</div>
                                </div>
                            </div>
                            
                            <div class="button-group">
                                <button type="submit" class="btn btn-primary">
                                    üìß Send Comparison Report
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div id="emailResults" style="display: none;">
                        <div class="alert alert-success">
                            <h4>üìß Email Sent Successfully!</h4>
                            <p>Report has been sent to <span id="sentToEmail"></span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settings-tab">
                <div class="content">
                    <h2>‚öôÔ∏è Settings & Configuration</h2>
                    <p style="margin-bottom: 30px;">Customize your VulnFixer experience and preferences.</p>
                    
                    <div class="feature-card">
                        <h3>üé® Appearance Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="customTitle">Application Title</label>
                                <input type="text" id="customTitle" 
                                       placeholder="Your Company VulnFixer Pro"
                                       value="Your Company VulnFixer Pro">
                                <div class="help-text">Customize the main title</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="customSubtitle">Subtitle</label>
                                <input type="text" id="customSubtitle" 
                                       placeholder="Advanced Security Vulnerability Management Platform"
                                       value="Advanced Security Vulnerability Management Platform">
                                <div class="help-text">Customize the subtitle</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="logoUpload">Logo Image</label>
                                <input type="file" id="logoUpload" accept="image/*">
                                <div class="help-text">Upload your company logo (recommended: 60x60px)</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="backgroundUpload">Background Image</label>
                                <input type="file" id="backgroundUpload" accept="image/*">
                                <div class="help-text">Upload custom background image</div>
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <button class="btn btn-primary" onclick="applyCustomization()">
                                üé® Apply Changes
                            </button>
                            <button class="btn btn-secondary" onclick="resetCustomization()">
                                üîÑ Reset to Default
                            </button>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <h3>ü§ñ AI Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="aiUsage">AI Usage Mode</label>
                                <select id="aiUsage">
                                    <option value="smart" selected>Smart (90% templates, 10% AI)</option>
                                    <option value="minimal">Minimal (Templates only, AI fallback)</option>
                                    <option value="aggressive">Aggressive (Use AI more frequently)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="cacheTimeout">Cache Timeout (minutes)</label>
                                <input type="number" id="cacheTimeout" value="60" min="5" max="1440">
                                <div class="help-text">How long to cache AI results</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <h3>üìß Email Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="defaultDomain">Company Email Domain</label>
                                <input type="text" id="defaultDomain" value="vaa.com" readonly>
                                <div class="help-text">All emails will use this domain</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="defaultSender">Default Sender Name</label>
                                <input type="text" id="defaultSender" value="VulnFixer Pro"
                                       placeholder="VulnFixer Pro">
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="autoSendReports" checked>
                                    Auto-send reports after fixing
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <button class="btn btn-secondary" onclick="testEmailSettings()">
                                    üìß Test Email Configuration
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables for original flow
        let vulnerabilities = [];
        let selectedVulnerabilities = new Set();
        let currentStep = 1;

        // Tab switching function
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // ORIGINAL FLOW FUNCTIONS - UNCHANGED
        
        // Step 1: Configuration
        document.getElementById('configForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Validate Bitbucket credentials
            const username = document.getElementById('bitbucketUsername').value;
            const token = document.getElementById('bitbucketToken').value;
            
            if (!username || !token) {
                alert('Bitbucket username and app password are required');
                return;
            }
            
            // Move to analysis step
            goToStep(2);
            
            // Analyze the report
            await analyzeReport();
        });

        async function analyzeReport() {
            const formData = new FormData();
            formData.append('report_file', document.getElementById('reportFile').files[0]);
            
            try {
                // Simulate API call for demo
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Mock data for demo
                const mockData = {
                    vulnerabilities_found: 25,
                    summary: { critical: 3, high: 8, medium: 10, low: 4 },
                    auto_fixable: 18,
                    detected_scanner: 'BlackDuck',
                    vulnerabilities: generateMockVulnerabilities()
                };
                
                vulnerabilities = mockData.vulnerabilities;
                displayAnalysisResults(mockData);
                
            } catch (error) {
                alert('Error analyzing report: ' + error.message);
                goToStep(1);
            }
        }

        function generateMockVulnerabilities() {
            const components = ['jackson-core', 'netty-common', 'spring-web', 'log4j-core', 'junit'];
            const severities = ['CRITICAL', 'HIGH', 'MEDIUM', 'LOW'];
            const mockVulns = [];
            
            for (let i = 0; i < 25; i++) {
                mockVulns.push({
                    id: `VULN-${i + 1}`,
                    component: components[i % components.length] + (i > 4 ? `-${Math.floor(i/5)}` : ''),
                    current_version: `${Math.floor(Math.random() * 5) + 1}.${Math.floor(Math.random() * 10)}.${Math.floor(Math.random() * 10)}`,
                    fixed_version: Math.random() > 0.3 ? `${Math.floor(Math.random() * 5) + 2}.${Math.floor(Math.random() * 10)}.${Math.floor(Math.random() * 10)}` : null,
                    severity: severities[Math.floor(Math.random() * severities.length)],
                    type: Math.random() > 0.6 ? 'direct' : 'transitive',
                    cve_id: Math.random() > 0.4 ? `CVE-2023-${10000 + i}` : null,
                    description: `Security vulnerability in ${components[i % components.length]}`
                });
            }
            
            return mockVulns;
        }

        function displayAnalysisResults(data) {
            document.getElementById('totalVulns').textContent = data.vulnerabilities_found || 0;
            document.getElementById('criticalCount').textContent = data.summary?.critical || 0;
            document.getElementById('highCount').textContent = data.summary?.high || 0;
            document.getElementById('mediumCount').textContent = data.summary?.medium || 0;
            document.getElementById('lowCount').textContent = data.summary?.low || 0;
            document.getElementById('fixableCount').textContent = data.auto_fixable || 0;
            
            document.getElementById('detectedScanner').textContent = data.detected_scanner || 'Unknown';
            document.getElementById('reportFormat').textContent = 
                document.getElementById('reportFile').files[0].name.split('.').pop().toUpperCase();
            
            document.querySelector('#section-2 .alert-info').style.display = 'none';
            document.getElementById('analysisResults').style.display = 'block';
        }

        function goToStep(step) {
            // Update active step
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active', 'completed'));
            for (let i = 1; i < step; i++) {
                document.getElementById(`step-${i}`).classList.add('completed');
            }
            document.getElementById(`step-${step}`).classList.add('active');
            
            // Update active section
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(`section-${step}`).classList.add('active');
            
            currentStep = step;
            
            // Load data for specific steps
            if (step === 3) {
                displayVulnerabilities();
            }
        }

        function displayVulnerabilities() {
            const tbody = document.getElementById('vulnerabilityTableBody');
            tbody.innerHTML = '';
            
            vulnerabilities.forEach((vuln, index) => {
                const row = tbody.insertRow();
                
                // Auto-select fixable vulnerabilities
                const autoSelect = vuln.fixed_version && vuln.severity !== 'LOW';
                if (autoSelect) {
                    selectedVulnerabilities.add(index);
                }
                
                row.innerHTML = `
                    <td>
                        <input type="checkbox" 
                               id="vuln-${index}" 
                               ${autoSelect ? 'checked' : ''}
                               onchange="toggleVulnerability(${index})">
                    </td>
                    <td><strong>${vuln.component || 'Unknown'}</strong></td>
                    <td>${vuln.current_version || 'Unknown'}</td>
                    <td>${vuln.fixed_version || '<span style="color: #e53e3e;">No fix available</span>'}</td>
                    <td><span class="severity-badge severity-${vuln.severity?.toLowerCase() || 'unknown'}">${vuln.severity || 'Unknown'}</span></td>
                    <td>${vuln.type || 'Unknown'}</td>
                    <td>${vuln.cve_id || '-'}</td>
                    <td>
                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" 
                                onclick="showDetails(${index})">Details</button>
                    </td>
                `;
            });
            
            updateSelectedCount();
        }

        function toggleVulnerability(index) {
            if (selectedVulnerabilities.has(index)) {
                selectedVulnerabilities.delete(index);
            } else {
                selectedVulnerabilities.add(index);
            }
            updateSelectedCount();
        }

        function updateSelectedCount() {
            document.getElementById('selectedCount').innerHTML = 
                `<strong>${selectedVulnerabilities.size}</strong> vulnerabilities selected for fixing`;
            
            // Update proceed button
            const proceedBtn = document.getElementById('proceedToFix');
            if (selectedVulnerabilities.size === 0) {
                proceedBtn.disabled = true;
                proceedBtn.textContent = 'Select vulnerabilities to proceed';
            } else {
                proceedBtn.disabled = false;
                proceedBtn.textContent = `Fix ${selectedVulnerabilities.size} Selected Vulnerabilities ‚Üí`;
            }
        }

        function selectAll() {
            vulnerabilities.forEach((_, index) => {
                selectedVulnerabilities.add(index);
                document.getElementById(`vuln-${index}`).checked = true;
            });
            updateSelectedCount();
        }

        function selectNone() {
            selectedVulnerabilities.clear();
            vulnerabilities.forEach((_, index) => {
                document.getElementById(`vuln-${index}`).checked = false;
            });
            updateSelectedCount();
        }

        function selectRecommended() {
            selectedVulnerabilities.clear();
            vulnerabilities.forEach((vuln, index) => {
                // Recommended: Critical and High severity with available fixes
                if ((vuln.severity === 'CRITICAL' || vuln.severity === 'HIGH') && vuln.fixed_version) {
                    selectedVulnerabilities.add(index);
                    document.getElementById(`vuln-${index}`).checked = true;
                } else {
                    document.getElementById(`vuln-${index}`).checked = false;
                }
            });
            updateSelectedCount();
        }

        function filterVulnerabilities() {
            const severity = document.getElementById('severityFilter').value;
            const type = document.getElementById('typeFilter').value;
            const fixable = document.getElementById('fixableFilter').value;
            
            const tbody = document.getElementById('vulnerabilityTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < vulnerabilities.length; i++) {
                const vuln = vulnerabilities[i];
                let show = true;
                
                if (severity !== 'all' && vuln.severity?.toLowerCase() !== severity) {
                    show = false;
                }
                
                if (type !== 'all' && vuln.type !== type) {
                    show = false;
                }
                
                if (fixable === 'fixable' && !vuln.fixed_version) {
                    show = false;
                } else if (fixable === 'no-fix' && vuln.fixed_version) {
                    show = false;
                }
                
                if (rows[i]) {
                    rows[i].style.display = show ? '' : 'none';
                }
            }
        }

        async function proceedToFix() {
            if (selectedVulnerabilities.size === 0) {
                alert('Please select at least one vulnerability to fix');
                return;
            }
            
            // Go to processing step
            goToStep(4);
            
            // Prepare selected vulnerabilities
            const selectedVulns = Array.from(selectedVulnerabilities).map(i => vulnerabilities[i]);
            
            // Update processing stats
            document.getElementById('processingTotal').textContent = selectedVulns.length;
            document.getElementById('processingSuccess').textContent = '0';
            document.getElementById('processingFailed').textContent = '0';
            document.getElementById('processingProgress').textContent = '0%';
            
            // Start processing
            await processVulnerabilities(selectedVulns);
        }

        async function processVulnerabilities(selectedVulns) {
            const progressLog = document.getElementById('progressLog');
            let successCount = 0;
            let failedCount = 0;
            
            // Process each vulnerability
            for (let i = 0; i < selectedVulns.length; i++) {
                const vuln = selectedVulns[i];
                
                // Add log entry
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry log-info';
                logEntry.textContent = `‚è≥ Processing ${vuln.component} (${vuln.current_version} ‚Üí ${vuln.fixed_version})...`;
                progressLog.appendChild(logEntry);
                progressLog.scrollTop = progressLog.scrollHeight;
                
                // Simulate processing delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Smart success rate based on whether fix is available
                const success = vuln.fixed_version ? (Math.random() > 0.15) : false; // 85% success rate if fix available
                
                if (success) {
                    successCount++;
                    const successEntry = document.createElement('div');
                    successEntry.className = 'log-entry log-success';
                    successEntry.textContent = `‚úÖ Successfully fixed ${vuln.component} (${vuln.fixed_version ? 'Template-based' : 'AI-enhanced'})`;
                    progressLog.appendChild(successEntry);
                } else {
                    failedCount++;
                    const failEntry = document.createElement('div');
                    failEntry.className = 'log-entry log-error';
                    failEntry.textContent = `‚ùå Failed to fix ${vuln.component}: ${vuln.fixed_version ? 'Build validation failed' : 'No fix available - skipped'}`;
                    progressLog.appendChild(failEntry);
                }
                
                // Update stats
                document.getElementById('processingSuccess').textContent = successCount;
                document.getElementById('processingFailed').textContent = failedCount;
                document.getElementById('processingProgress').textContent = 
                    Math.round(((i + 1) / selectedVulns.length) * 100) + '%';
                
                progressLog.scrollTop = progressLog.scrollHeight;
            }
            
            // Add completion log
            const completeEntry = document.createElement('div');
            completeEntry.className = 'log-entry log-success';
            completeEntry.textContent = `üéâ Processing complete! ${successCount} fixed, ${failedCount} failed`;
            progressLog.appendChild(completeEntry);
            
            // Show results
            setTimeout(() => {
                showResults(successCount, failedCount, selectedVulns.length);
            }, 1500);
        }

        function showResults(successCount, failedCount, totalCount) {
            goToStep(5);
            
            const resultsSection = document.getElementById('resultsSection');
            
            const successRate = Math.round((successCount / totalCount) * 100);
            const alertClass = successCount > 0 ? 'alert-success' : 'alert-warning';
            
            // Calculate AI usage (simulate smart usage)
            const templateFixes = Math.floor(successCount * 0.9); // 90% template-based
            const aiFixes = successCount - templateFixes; // 10% AI-enhanced
            
            resultsSection.innerHTML = `
                <div class="${alertClass}">
                    <h3>Fix Process Completed</h3>
                    <p>Successfully fixed ${successCount} out of ${totalCount} selected vulnerabilities (${successRate}% success rate)</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${totalCount}</div>
                        <div class="stat-label">Total Processed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #48bb78;">${successCount}</div>
                        <div class="stat-label">Successfully Fixed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #e53e3e;">${failedCount}</div>
                        <div class="stat-label">Failed/Skipped</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${successRate}%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                </div>
                
                <div style="background: rgba(230, 255, 250, 0.8); padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #38b2ac;">
                    <h4>ü§ñ AI Efficiency Report</h4>
                    <p><strong>Template-based fixes:</strong> ${templateFixes} (${Math.round((templateFixes/successCount)*100)}%)</p>
                    <p><strong>AI-enhanced fixes:</strong> ${aiFixes} (${Math.round((aiFixes/successCount)*100)}%)</p>
                    <p>Our smart approach used simple templates for most fixes, reserving AI for complex cases only.</p>
                </div>
                
                ${successCount > 0 ? `
                <div class="alert alert-info" style="margin-top: 20px;">
                    <h4>Pull Request Created</h4>
                    <p>Branch: <code>vulnfixer-fixes-${Date.now()}</code></p>
                    <p>A pull request has been created with all successful fixes. Each fix has been validated with Maven build.</p>
                </div>
                ` : ''}
                
                ${failedCount > 0 ? `
                <div class="alert alert-warning" style="margin-top: 20px;">
                    <h4>Manual Review Required</h4>
                    <p>${failedCount} vulnerabilities could not be fixed automatically. These may require:</p>
                    <ul>
                        <li>Manual version updates (incompatible changes)</li>
                        <li>Code modifications (API changes)</li>
                        <li>Alternative dependency selection</li>
                        <li>No fix currently available</li>
                    </ul>
                </div>
                ` : ''}
            `;
            
            // Show PR button if successful
            if (successCount > 0) {
                document.getElementById('viewPR').style.display = 'inline-block';
                document.getElementById('viewPR').onclick = () => {
                    window.open('https://bitbucket.org/workspace/repo/pull-requests', '_blank');
                };
            }
        }

        function startOver() {
            // Reset everything
            selectedVulnerabilities.clear();
            vulnerabilities = [];
            currentStep = 1;
            
            // Reset form
            document.getElementById('configForm').reset();
            
            // Go back to step 1
            goToStep(1);
        }

        function showDetails(index) {
            const vuln = vulnerabilities[index];
            alert(`Vulnerability Details:
            
Component: ${vuln.component}
Current Version: ${vuln.current_version}
Fixed Version: ${vuln.fixed_version || 'Not available'}
Severity: ${vuln.severity}
CVE: ${vuln.cve_id || 'Not available'}
Type: ${vuln.type}
Description: ${vuln.description}`);
        }

        function toggleAll() {
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            const isChecked = selectAllCheckbox.checked;
            
            selectedVulnerabilities.clear();
            
            vulnerabilities.forEach((_, index) => {
                const checkbox = document.getElementById(`vuln-${index}`);
                if (checkbox && checkbox.style.display !== 'none') {
                    checkbox.checked = isChecked;
                    if (isChecked) {
                        selectedVulnerabilities.add(index);
                    }
                }
            });
            
            updateSelectedCount();
        }

        // NEW FEATURES FUNCTIONS

        // Compare Scans Form
        document.getElementById('compareScanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const oldFile = document.getElementById('oldScanFile').files[0];
            const newFile = document.getElementById('newScanFile').files[0];
            
            if (!oldFile || !newFile) {
                alert('Please upload both scan files');
                return;
            }
            
            // Show processing
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;
            button.textContent = 'üîÑ Processing...';
            button.disabled = true;
            
            // Simulate processing
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            // Show mock results
            document.getElementById('compareResults').style.display = 'block';
            document.getElementById('fixedIssues').textContent = '12';
            document.getElementById('newIssues').textContent = '5';
            document.getElementById('persistentIssues').textContent = '8';
            document.getElementById('needsAttention').textContent = '13';
            
            // Reset button
            button.textContent = originalText;
            button.disabled = false;
            
            // Add download functionality
            document.getElementById('downloadComparisonBtn').onclick = function() {
                alert('Downloading comparison report...\n\nFile: vulnerability_comparison_' + new Date().toISOString().split('T')[0] + '.html');
            };
        });

        // Email Report Form
        document.getElementById('emailReportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const recipientUsername = document.getElementById('recipientUsername').value;
            const reportFile = document.getElementById('emailReportFile').files[0];
            
            if (!recipientUsername || !reportFile) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Show processing
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;
            button.textContent = 'üì§ Sending...';
            button.disabled = true;
            
            // Simulate email sending
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Show success
            const resultsDiv = document.getElementById('emailResults');
            document.getElementById('sentToEmail').textContent = recipientUsername + '@vaa.com';
            resultsDiv.style.display = 'block';
            
            // Reset form and button
            this.reset();
            button.textContent = originalText;
            button.disabled = false;
            
            // Hide results after 5 seconds
            setTimeout(() => {
                resultsDiv.style.display = 'none';
            }, 5000);
        });

        // Email Comparison Form
        document.getElementById('emailComparisonForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const recipient = document.getElementById('comparisonRecipient').value;
            const oldScan = document.getElementById('emailOldScan').files[0];
            const newScan = document.getElementById('emailNewScan').files[0];
            
            if (!recipient || !oldScan || !newScan) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Show processing
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;
            button.textContent = 'üì§ Generating & Sending...';
            button.disabled = true;
            
            // Simulate processing
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            // Show success
            alert(`‚úÖ Comparison report sent successfully to ${recipient}@vaa.com!\n\nReport includes:\n- 12 fixed vulnerabilities\n- 5 new vulnerabilities\n- 8 persistent issues\n- Actionable recommendations`);
            
            // Reset form and button
            this.reset();
            button.textContent = originalText;
            button.disabled = false;
        });

        // CUSTOMIZATION FUNCTIONS

        function applyCustomization() {
            const title = document.getElementById('customTitle').value;
            const subtitle = document.getElementById('customSubtitle').value;
            const logoFile = document.getElementById('logoUpload').files[0];
            const backgroundFile = document.getElementById('backgroundUpload').files[0];
            
            // Update title and subtitle
            if (title) {
                document.querySelector('.header h1').textContent = title;
            }
            if (subtitle) {
                document.querySelector('.header p').textContent = subtitle;
            }
            
            // Update logo
            if (logoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const logoDiv = document.querySelector('.custom-logo');
                    logoDiv.innerHTML = `<img src="${e.target.result}" alt="Custom Logo" style="width: 100%; height: 100%; object-fit: contain; border-radius: 50%;">`;
                };
                reader.readAsDataURL(logoFile);
            }
            
            // Update background
            if (backgroundFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.body.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('${e.target.result}')`;
                };
                reader.readAsDataURL(backgroundFile);
            }
            
            // Save to localStorage
            const customization = {
                title: title,
                subtitle: subtitle,
                appliedAt: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('vulnfixer_customization', JSON.stringify(customization));
                alert('‚úÖ Customization applied successfully!');
            } catch (e) {
                alert('‚úÖ Customization applied! (Note: Settings won\'t persist in this demo environment)');
            }
        }

        function resetCustomization() {
            // Reset to defaults
            document.querySelector('.header h1').textContent = 'Your Company VulnFixer Pro';
            document.querySelector('.header p').textContent = 'Advanced Security Vulnerability Management Platform';
            document.querySelector('.custom-logo').innerHTML = 'üõ°Ô∏è';
            
            // Reset background
            document.body.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><rect fill="%23667eea" width="1200" height="800"/><circle fill="%23764ba2" cx="200" cy="200" r="100" opacity="0.3"/><circle fill="%23667eea" cx="800" cy="300" r="150" opacity="0.2"/><circle fill="%23764ba2" cx="1000" cy="600" r="120" opacity="0.3"/></svg>')`;
            
            // Reset form
            document.getElementById('customTitle').value = 'Your Company VulnFixer Pro';
            document.getElementById('customSubtitle').value = 'Advanced Security Vulnerability Management Platform';
            document.getElementById('logoUpload').value = '';
            document.getElementById('backgroundUpload').value = '';
            
            // Clear localStorage
            try {
                localStorage.removeItem('vulnfixer_customization');
            } catch (e) {
                // Ignore localStorage errors in demo
            }
            
            alert('üîÑ Reset to default appearance');
        }

        function testEmailSettings() {
            alert('üß™ Testing Email Configuration...\n\n‚úÖ SMTP Connection: Success\n‚úÖ Authentication: Valid\n‚úÖ Domain Configuration: vaa.com\n\nEmail service is ready to use!');
        }

        // File upload enhancements
        function setupFileUploadEnhancements() {
            // Add drag and drop to upload zones
            document.querySelectorAll('.upload-zone').forEach(zone => {
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                zone.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                });
                
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const fileInput = this.parentElement.querySelector('input[type="file"]');
                        if (fileInput) {
                            fileInput.files = files;
                            
                            // Update UI to show file selected
                            const fileName = files[0].name;
                            this.innerHTML = `
                                <div style="font-size: 2em; margin-bottom: 10px; color: #48bb78;">‚úì</div>
                                <p><strong>File Selected:</strong> ${fileName}</p>
                                <p class="help-text">Click to change file</p>
                            `;
                        }
                    }
                });
            });
            
            // Update upload zones when files are selected
            document.querySelectorAll('input[type="file"]').forEach(input => {
                input.addEventListener('change', function() {
                    if (this.files.length > 0) {
                        const fileName = this.files[0].name;
                        const uploadZone = this.parentElement.querySelector('.upload-zone');
                        if (uploadZone) {
                            uploadZone.innerHTML = `
                                <div style="font-size: 2em; margin-bottom: 10px; color: #48bb78;">‚úì</div>
                                <p><strong>File Selected:</strong> ${fileName}</p>
                                <p class="help-text">Click to change file</p>
                            `;
                        }
                    }
                });
            });
        }

        // Load saved customization on page load
        function loadSavedCustomization() {
            try {
                const saved = localStorage.getItem('vulnfixer_customization');
                if (saved) {
                    const customization = JSON.parse(saved);
                    
                    if (customization.title) {
                        document.querySelector('.header h1').textContent = customization.title;
                        document.getElementById('customTitle').value = customization.title;
                    }
                    
                    if (customization.subtitle) {
                        document.querySelector('.header p').textContent = customization.subtitle;
                        document.getElementById('customSubtitle').value = customization.subtitle;
                    }
                }
            } catch (e) {
                // Ignore localStorage errors
            }
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setupFileUploadEnhancements();
            loadSavedCustomization();
            
            // Add some interactive help
            document.querySelectorAll('.help-text').forEach(help => {
                help.style.cursor = 'help';
                help.addEventListener('click', function() {
                    this.style.background = 'rgba(102, 126, 234, 0.1)';
                    this.style.padding = '5px';
                    this.style.borderRadius = '4px';
                    
                    setTimeout(() => {
                        this.style.background = '';
                        this.style.padding = '';
                        this.style.borderRadius = '';
                    }, 2000);
                });
            });
            
            // Show a welcome message
            setTimeout(() => {
                console.log('üõ°Ô∏è VulnFixer Pro Enhanced - Ready for use!');
                console.log('‚ú® Features available:');
                console.log('  - Smart vulnerability fixing (90% template-based)');
                console.log('  - Scan comparison reports');
                console.log('  - Email notifications (@vaa.com)');
                console.log('  - Custom branding options');
            }, 1000);
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è VulnFixer Pro - Your Custom Security Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* Custom background - replace with your image */
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><rect fill="%23667eea" width="1200" height="800"/><circle fill="%23764ba2" cx="200" cy="200" r="100" opacity="0.3"/><circle fill="%23667eea" cx="800" cy="300" r="150" opacity="0.2"/><circle fill="%23764ba2" cx="1000" cy="600" r="120" opacity="0.3"/></svg>');
            background-size: cover;
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .main-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            /* Customizable title - change this */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .logo-area {
            margin-bottom: 20px;
        }

        .custom-logo {
            /* Add your logo here */
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }

        /* Navigation for different features */
        .nav-tabs {
            display: flex;
            background: rgba(248, 249, 250, 0.9);
            border-bottom: 1px solid rgba(233, 236, 239, 0.5);
            backdrop-filter: blur(10px);
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #6c757d;
            text-align: center;
        }

        .nav-tab.active {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .nav-tab:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        /* ORIGINAL Fix Vulnerabilities Flow - UNCHANGED */
        .workflow-steps {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            padding: 0 30px;
            flex-wrap: wrap;
        }

        .step {
            flex: 1;
            text-align: center;
            padding: 20px;
            position: relative;
            min-width: 120px;
        }

        .step:not(:last-child)::after {
            content: '‚Üí';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            color: #cbd5e0;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #4a5568;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .step.active .step-number {
            background: #667eea;
            color: white;
        }

        .step.completed .step-number {
            background: #48bb78;
            color: white;
        }

        .content {
            padding: 30px;
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Forms and UI Elements */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2d3748;
            font-weight: 600;
            font-size: 14px;
        }

        .required::after {
            content: ' *';
            color: #e53e3e;
        }

        input[type="text"],
        input[type="url"],
        input[type="password"],
        input[type="file"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(226, 232, 240, 0.8);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 1);
        }

        .help-text {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }

        .vulnerability-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            overflow: hidden;
        }

        .vulnerability-table th {
            background: rgba(247, 250, 252, 0.9);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
        }

        .vulnerability-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        }

        .vulnerability-table tr:hover {
            background: rgba(247, 250, 252, 0.5);
        }

        .severity-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .severity-critical {
            background: #fed7d7;
            color: #c53030;
        }

        .severity-high {
            background: #feebc8;
            color: #c05621;
        }

        .severity-medium {
            background: #fef5e7;
            color: #d69e2e;
        }

        .severity-low {
            background: #e6fffa;
            color: #0e7490;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: rgba(226, 232, 240, 0.8);
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: rgba(203, 213, 224, 0.8);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(248, 249, 250, 0.9);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.5);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2d3748;
        }

        .stat-label {
            color: #718096;
            margin-top: 5px;
        }

        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(247, 250, 252, 0.8);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .alert-info {
            background: rgba(190, 227, 248, 0.9);
            color: #2c5282;
            border-left: 4px solid #3182ce;
        }

        .alert-warning {
            background: rgba(254, 235, 200, 0.9);
            color: #7c2d12;
            border-left: 4px solid #dd6b20;
        }

        .alert-success {
            background: rgba(198, 246, 213, 0.9);
            color: #22543d;
            border-left: 4px solid #48bb78;
        }

        .alert-error {
            background: rgba(254, 215, 215, 0.9);
            color: #742a2a;
            border-left: 4px solid #e53e3e;
        }

        .progress-log {
            background: rgba(26, 32, 44, 0.9);
            color: #a0aec0;
            padding: 20px;
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
        }

        .log-success {
            color: #68d391;
        }

        .log-error {
            color: #fc8181;
        }

        .log-warning {
            color: #f6e05e;
        }

        .log-info {
            color: #63b3ed;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(226, 232, 240, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* NEW FEATURES STYLING */
        .feature-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .upload-zone {
            border: 2px dashed rgba(203, 213, 224, 0.8);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
            background: rgba(248, 249, 250, 0.5);
            cursor: pointer;
        }

        .upload-zone:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .upload-zone.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .email-config {
            background: rgba(230, 255, 250, 0.8);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #38b2ac;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .workflow-steps {
                flex-direction: column;
                align-items: center;
            }
            
            .step:not(:last-child)::after {
                content: '‚Üì';
                position: static;
                transform: none;
                margin: 10px 0;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .button-group {
                flex-direction: column;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(241, 245, 249, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-card">
            <div class="header">
                <div class="logo-area">
                    <div class="custom-logo">
                        üõ°Ô∏è
                        <!-- Replace with your logo: <img src="your-logo.png" alt="Logo" style="width: 100%; height: 100%; object-fit: contain;"> -->
                    </div>
                </div>
                <!-- CUSTOMIZABLE: Change your title here -->
                <h1>Your Company VulnFixer Pro</h1>
                <p>Advanced Security Vulnerability Management Platform</p>
                <!-- CUSTOMIZABLE: Add your company tagline here -->
            </div>

            <!-- Navigation Tabs for Features -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('fix-vulnerabilities')">
                    üîß Fix Vulnerabilities
                </button>
                <button class="nav-tab" onclick="switchTab('compare-scans')">
                    üìä Compare Scans
                </button>
                <button class="nav-tab" onclick="switchTab('email-reports')">
                    üìß Email Reports
                </button>
                <button class="nav-tab" onclick="switchTab('settings')">
                    ‚öôÔ∏è Settings
                </button>
            </div>

            <!-- ORIGINAL Fix Vulnerabilities Tab - UNCHANGED FLOW -->
            <div class="tab-content active" id="fix-vulnerabilities-tab">
                <div class="workflow-steps">
                    <div class="step active" id="step-1">
                        <div class="step-number">1</div>
                        <div>Configure</div>
                    </div>
                    <div class="step" id="step-2">
                        <div class="step-number">2</div>
                        <div>Scan Report</div>
                    </div>
                    <div class="step" id="step-3">
                        <div class="step-number">3</div>
                        <div>Select Fixes</div>
                    </div>
                    <div class="step" id="step-4">
                        <div class="step-number">4</div>
                        <div>Apply Fixes</div>
                    </div>
                    <div class="step" id="step-5">
                        <div class="step-number">5</div>
                        <div>Pull Request</div>
                    </div>
                </div>

                <div class="content">
                    <!-- Step 1: Configuration - ORIGINAL -->
                    <div class="section active" id="section-1">
                        <h2>Step 1: Configuration</h2>
                        <p style="margin-bottom: 20px;">Configure your repository and authentication settings</p>
                        
                        <form id="configForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="bitbucketUsername" class="required">Bitbucket Username</label>
                                    <input type="text" id="bitbucketUsername" name="bitbucket_username" required 
                                           placeholder="your.username">
                                    <div class="help-text">Your Bitbucket username or email</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="bitbucketToken" class="required">Bitbucket App Password</label>
                                    <input type="password" id="bitbucketToken" name="bitbucket_token" required
                                           placeholder="App password">
                                    <div class="help-text">Generate from Bitbucket settings ‚Üí App passwords</div>
                                </div>
                                
                                <div class="form-group full-width">
                                    <label for="repoUrl" class="required">Repository URL</label>
                                    <input type="url" id="repoUrl" name="repo_url" required
                                           placeholder="https://bitbucket.org/workspace/repository">
                                    <div class="help-text">Full URL to your Bitbucket repository</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="reportFile" class="required">Vulnerability Report</label>
                                    <input type="file" id="reportFile" name="report_file" required
                                           accept=".csv,.json,.xml,.html">
                                    <div class="help-text">Supports BlackDuck, Trivy, Xray, Snyk, etc.</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="branchName">Custom Branch Name</label>
                                    <input type="text" id="branchName" name="branch_name" 
                                           placeholder="vulnfixer-fixes (auto-generated if empty)">
                                    <div class="help-text">Leave empty for auto-generated name</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="validation">Validation</label>
                                    <select id="validation" name="validation">
                                        <option value="compile">Compile only</option>
                                        <option value="test" selected>Compile + Test</option>
                                        <option value="none">No validation</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="button-group">
                                <div></div>
                                <button type="submit" class="btn btn-primary">
                                    Next: Analyze Report ‚Üí
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Step 2: Analysis - ORIGINAL -->
                    <div class="section" id="section-2">
                        <h2>Step 2: Report Analysis</h2>
                        <p style="margin-bottom: 20px;">Analyzing your vulnerability report...</p>
                        
                        <div class="alert alert-info">
                            <div class="spinner"></div>
                            Parsing vulnerability report and detecting scanner type...
                        </div>
                        
                        <div id="analysisResults" style="display: none;">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-number" id="totalVulns">0</div>
                                    <div class="stat-label">Total Vulnerabilities</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="criticalCount">0</div>
                                    <div class="stat-label">Critical</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="highCount">0</div>
                                    <div class="stat-label">High</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="mediumCount">0</div>
                                    <div class="stat-label">Medium</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="lowCount">0</div>
                                    <div class="stat-label">Low</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="fixableCount">0</div>
                                    <div class="stat-label">Auto-Fixable</div>
                                </div>
                            </div>
                            
                            <div class="alert alert-success">
                                <strong>Scanner Detected:</strong> <span id="detectedScanner">Unknown</span><br>
                                <strong>Report Format:</strong> <span id="reportFormat">Unknown</span>
                            </div>
                            
                            <div class="button-group">
                                <button class="btn btn-secondary" onclick="goToStep(1)">
                                    ‚Üê Back to Configuration
                                </button>
                                <button class="btn btn-primary" onclick="goToStep(3)">
                                    Next: Select Vulnerabilities ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Selection - ORIGINAL -->
                    <div class="section" id="section-3">
                        <h2>Step 3: Select Vulnerabilities to Fix</h2>
                        <p style="margin-bottom: 20px;">Choose which vulnerabilities you want to fix</p>
                        
                        <div class="filter-bar">
                            <div class="filter-group">
                                <label>Severity:</label>
                                <select id="severityFilter" onchange="filterVulnerabilities()">
                                    <option value="all">All</option>
                                    <option value="critical">Critical</option>
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label>Type:</label>
                                <select id="typeFilter" onchange="filterVulnerabilities()">
                                    <option value="all">All</option>
                                    <option value="direct">Direct Dependencies</option>
                                    <option value="transitive">Transitive Dependencies</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label>Fixable:</label>
                                <select id="fixableFilter" onchange="filterVulnerabilities()">
                                    <option value="all">All</option>
                                    <option value="fixable">Has Fix Available</option>
                                    <option value="no-fix">No Fix Available</option>
                                </select>
                            </div>
                            
                            <div class="filter-group" style="margin-left: auto;">
                                <button class="btn btn-secondary" onclick="selectAll()">Select All</button>
                                <button class="btn btn-secondary" onclick="selectNone()">Select None</button>
                                <button class="btn btn-secondary" onclick="selectRecommended()">Select Recommended</button>
                            </div>
                        </div>
                        
                        <div id="selectedCount" class="alert alert-info">
                            <strong>0</strong> vulnerabilities selected for fixing
                        </div>
                        
                        <table class="vulnerability-table">
                            <thead>
                                <tr>
                                    <th style="width: 40px;">
                                        <input type="checkbox" id="selectAllCheckbox" onchange="toggleAll()">
                                    </th>
                                    <th>Component</th>
                                    <th>Current Version</th>
                                    <th>Fixed Version</th>
                                    <th>Severity</th>
                                    <th>Type</th>
                                    <th>CVE</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vulnerabilityTableBody">
                                <!-- Dynamically populated -->
                            </tbody>
                        </table>
                        
                        <div class="button-group">
                            <button class="btn btn-secondary" onclick="goToStep(2)">
                                ‚Üê Back to Analysis
                            </button>
                            <button class="btn btn-primary" id="proceedToFix" onclick="proceedToFix()">
                                Fix Selected Vulnerabilities ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Processing - ORIGINAL -->
                    <div class="section" id="section-4">
                        <h2>Step 4: Processing Fixes</h2>
                        <p style="margin-bottom: 20px;">Applying selected vulnerability fixes...</p>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="processingTotal">0</div>
                                <div class="stat-label">Total to Fix</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="processingSuccess">0</div>
                                <div class="stat-label">Successful</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="processingFailed">0</div>
                                <div class="stat-label">Failed</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="processingProgress">0%</div>
                                <div class="stat-label">Progress</div>
                            </div>
                        </div>
                        
                        <h3 style="margin-top: 30px;">Live Progress Log:</h3>
                        <div class="progress-log" id="progressLog">
                            <div class="log-entry log-info">üöÄ Starting vulnerability fix process...</div>
                        </div>
                    </div>

                    <!-- Step 5: Review - ORIGINAL -->
                    <div class="section" id="section-5">
                        <h2>Step 5: Review Results</h2>
                        <p style="margin-bottom: 20px;">Fix process completed</p>
                        
                        <div id="resultsSection">
                            <!-- Populated after processing -->
                        </div>
                        
                        <div class="button-group">
                            <button class="btn btn-secondary" onclick="startOver()">
                                Start New Fix Process
                            </button>
                            <button class="btn btn-primary" id="viewPR" style="display: none;">
                                View Pull Request ‚Üí
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEW FEATURE: Compare Scans Tab -->
            <div class="tab-content" id="compare-scans-tab">
                <div class="content">
                    <h2>üìä Compare Vulnerability Scans</h2>
                    <p style="margin-bottom: 30px;">Compare two vulnerability scan reports to identify progress and new issues.</p>
